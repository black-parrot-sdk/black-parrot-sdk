variables:
  GIT_STRATEGY: fetch
  GIT_SUBMODULE_STRATEGY: none

default:
    image: registry.gitlab.com/dpetrisko/black-parrot-sdk:latest

stages:
    - checkout
    - tools
    - perch
    - progs

.job_template: &job_definition
  only:
    - pushes
  artifacts:
    when: always
    paths:
      - "*.log"
      - include/
      - lib/
      - install/
      - progs/
      - ucode/
    expire_in: "1 day"

checkout:
  <<: *job_definition
  stage: checkout
  script:
    - make checkout -j $CI_NUM_CORES | tee checkout.log

build_bedrock:
  <<: *job_definition
  stage: tools
  script:
    - make bedrock -j1 | tee bedrock.log

build_dromajo:
  <<: *job_definition
  stage: tools
  script:
    - make dromajo | tee dromajo.log

build_gnudramfs:
  <<: *job_definition
  stage: tools
  script:
    - make gnudramfs | tee gnudramfs.log

build_perch:
  <<: *job_definition
  stage: perch
  script:
    - make perch | tee perch.log

build_bootrom:
  <<: *job_definition
  stage: progs
  script:
    - make bootrom | tee bootrom.log

build_bp-demos:
  <<: *job_definition
  stage: progs
  script:
    - make bp-demos | tee bp-demos.log

build_bp-tests:
  <<: *job_definition
  stage: progs
  script:
    - make bp-tests | tee bp-tests.log

build_riscv-tests:
  <<: *job_definition
  stage: progs
  script:
    - make riscv-tests | tee riscv-tests.log

build_coremark:
  <<: *job_definition
  stage: progs
  script:
    - make coremark | tee coremark.log

build_beebs:
  <<: *job_definition
  stage: progs
  script:
    - make beebs | tee beebs.log

